(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{490:function(s,t,e){"use strict";e.r(t);var r=e(2),a=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"frp实现内网穿透"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#frp实现内网穿透"}},[s._v("#")]),s._v(" frp实现内网穿透")]),s._v(" "),t("blockquote",[t("p",[s._v("前提概要：服务器端和客户端都需要预装 docker")])]),s._v(" "),t("h2",{attrs:{id:"一、简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、简介"}},[s._v("#")]),s._v(" 一、简介")]),s._v(" "),t("p",[s._v("frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透。 详细文档请参考：https://github.com/fatedier/frp/blob/master/README_zh.md")]),s._v(" "),t("p",[s._v("frp 支持 macOS, freebsd, windows,linux x64,linux i386, linux arm,Linux arm64, Mips 等不同的系统和 CPU 架构，并分别打包了文件。")]),s._v(" "),t("p",[s._v("因此，为了方便在不同的系统中安装和配置 frp，我基于 docker 对 frp 进行了封装和打包。")]),s._v(" "),t("p",[s._v("但是由于 docker 的限制，目前只支持(amd64, arm32v6, arm32v70, arm64v8, i386)")]),s._v(" "),t("p",[s._v("项目地址：")]),s._v(" "),t("p",[s._v("https://github.com/snowdreamtech/frp")]),s._v(" "),t("p",[s._v("DockerHub：")]),s._v(" "),t("p",[s._v("https://hub.docker.com/r/snowdreamtech/frps")]),s._v(" "),t("p",[s._v("https://hub.docker.com/r/snowdreamtech/frpc")]),s._v(" "),t("h2",{attrs:{id:"二、配置以及使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、配置以及使用"}},[s._v("#")]),s._v(" 二、配置以及使用")]),s._v(" "),t("p",[s._v("将 "),t("strong",[s._v("frps")]),s._v(" 及 "),t("strong",[s._v("frps.ini")]),s._v(" 放到具有公网 IP 的机器上。")]),s._v(" "),t("p",[s._v("将 "),t("strong",[s._v("frpc")]),s._v(" 及 "),t("strong",[s._v("frpc.ini")]),s._v(" 放到处于内网环境的机器上。")]),s._v(" "),t("h3",{attrs:{id:"通过-ssh-访问公司内网机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过-ssh-访问公司内网机器"}},[s._v("#")]),s._v(" 通过 ssh 访问公司内网机器")]),s._v(" "),t("ol",[t("li",[s._v("修改 frps.ini 文件，这里使用了最简化的配置，设置了 frp 服务器端接收客户端流量的端口：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# frps.ini\n[common]\nbind_port = 7000\n")])])]),t("ol",[t("li",[s._v("启动 frps：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker run  --network host -d -v /etc/frp/frps.ini:/etc/frp/frps.ini --name frps snowdreamtech/frps\n")])])]),t("ol",[t("li",[s._v("修改 frpc.ini 文件，假设 frps 所在服务器的公网 IP 为 x.x.x.x：")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# frpc.ini\n[common]\nserver_addr = x.x.x.x\nserver_port = 7000\n\n[ssh]\ntype = tcp\nlocal_ip = 127.0.0.1\nlocal_port = 22\nremote_port = 6000\n")])])]),t("p",[s._v("注意，"),t("code",[s._v("local_port")]),s._v("（客户端侦听）和 "),t("code",[s._v("remote_port")]),s._v("（服务器端暴露）是用来出入 frp 系统的两端，"),t("code",[s._v("server_port")]),s._v(" 则是服务器用来与客户端通讯的。")]),s._v(" "),t("ol",[t("li",[s._v("启动 frpc：")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--network")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /etc/frp/frpc.ini:/etc/frp/frpc.ini "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" frpc snowdreamtech/frpc\n")])])]),t("ol",[t("li",[s._v("通过 ssh 访问内网机器，假设用户名(客户端内网服务器用户名)为 test：，服务端ip地址：x.x.x.x")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" test@x.x.x.x "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6000")]),s._v("\n")])])]),t("p",[s._v("到这里你已经完成了一个简单的内网穿透demo，如果想了解更多可以看"),t("a",{attrs:{href:"https://github.com/fatedier/frp/blob/master/README_zh.md#%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"}},[s._v("frp项目中文文档"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"三、问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、问题"}},[s._v("#")]),s._v(" 三、问题")]),s._v(" "),t("p",[s._v("在第三方远程ssh登入内网服务器时发生该错误")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('ubuntu@VM-28-88-ubuntu:~$ ssh -p 6001 mumu@xxx.xxx.xxx.xx\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the ECDSA key sent by the remote host is\nSHA256:aAfoz7L7j6vNUp7sUwOFiCE/ZF0VbveCDJ6f1/+5ezQ.\nPlease contact your system administrator.\nAdd correct host key in /home/ubuntu/.ssh/known_hosts to get rid of this message.\nOffending ECDSA key in /home/ubuntu/.ssh/known_hosts:3\n  remove with:\n  ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R "[xxx.xxx.xxx.xx]:6001"\nECDSA host key for [xxx.xxx.xxx.xx]:6001 has changed and you have requested strict checking.\nHost key verification failed.\n')])])]),t("p",[s._v("原因可能是之前有在这个服务器上ssh登入过这台内网服务器，后面因为一些原因调整了这台内网服务器的frp配置导致的")]),s._v(" "),t("h3",{attrs:{id:"解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),t("p",[s._v("根据上面给出的提示")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Add correct host key in /home/ubuntu/.ssh/known_hosts to get rid of this message.\nOffending ECDSA key in /home/ubuntu/.ssh/known_hosts:3\n  remove with:\n  ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R "[xxx.xxx.xxx.xx]:6001"\nECDSA host key for [xxx.xxx.xxx.xx]:6001 has changed and you have requested strict checking.\n')])])]),t("p",[s._v("进入known_hosts文件删除第三行xxx.xxx.xxx.xx:6001配置")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /home/ubuntu/.ssh/known_hosts\n")])])]),t("p",[s._v("删除完毕，保存退出:wq")]),s._v(" "),t("p",[s._v("这样你就又可以愉快的玩耍了~! ^_^")]),s._v(" "),t("h2",{attrs:{id:"四、感谢大佬"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、感谢大佬"}},[s._v("#")]),s._v(" 四、感谢大佬")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/fatedier/frp/blob/master/README_zh.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("frp项目中文文档"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.itcoder.tech/posts/docker-frp/",target:"_blank",rel:"noopener noreferrer"}},[s._v("frp docker镜像 中文文档"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=a.exports}}]);